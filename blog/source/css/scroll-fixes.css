/* ===================================================================
   Comprehensive Scroll Performance & Stability Fixes
   
   Root causes addressed:
   1. Scrollbar appearance/disappearance → scrollbar-gutter: stable
   2. Layout recalculation during scroll → contain: layout paint style
   3. Frequent repaint/reflow → GPU acceleration + will-change
   4. Sidebar affix state thrashing → locked height + no transitions
   5. Footer/widget height instability → fixed min-heights
   =================================================================== */

/* 1. UNIVERSAL SCROLLBAR STABILITY - prevents all layout shift */
html, body {
  scrollbar-gutter: stable;
}

/* 2. HEADER & WAVE ANIMATION - GPU acceleration */
#header {
  will-change: transform;
  contain: layout style paint;
}

.waves {
  will-change: transform;
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  contain: layout style paint;
}

.waves use {
  will-change: transform;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

.parallax {
  will-change: transform;
}

/* 3. MAIN CONTENT AREA - isolate from scroll events */
main {
  contain: content;
  will-change: scroll-position;
}

main > .inner {
  contain: layout style paint;
}

/* 4. SIDEBAR - prevent reflow during affix state changes */
#sidebar {
  /* Disable transitions to avoid animation jank during affix toggle */
  transition: none !important;
}

#sidebar.on,
#sidebar.affix {
  /* Lock dimensions during state change */
  min-width: auto;
  max-width: 100%;
  contain: layout style paint;
}

#sidebar.affix {
  position: fixed;
  z-index: 10;
  will-change: position;
}

#sidebar .inner {
  contain: layout style;
}

#sidebar .panels {
  /* Stabilize panels container */
  min-height: auto;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  contain: layout;
}

/* 5. FOOTER & WIDGETS - fixed minimum heights */
#footer {
  min-height: 100px;
  contain: layout style;
}

#footer .widgets {
  min-height: 40px;
  contain: layout;
}

#footer .status {
  min-height: 30px;
}

/* 6. QUICK NAVIGATION - prevent jitter */
#quick {
  will-change: opacity;
  contain: layout style paint;
}

/* 7. TOOL PANEL - reduce reflow */
#tool {
  contain: layout style paint;
}

#tool.affix {
  will-change: position;
}

/* 8. BRAND/TITLE - smooth transitions without jank */
#brand {
  transition: none;
}

#brand.affix {
  will-change: transform;
}

/* 9. PREVENT GLOBAL REFLOW - lock critical ancestors */
#container {
  contain: content;
}

#page {
  contain: layout style;
}

/* 10. SMOOTHING FOR SCROLL-DEPENDENT ANIMATIONS */
* {
  /* Globally disable pointer events during scroll for better performance */
  scroll-behavior: auto;
}

@supports (scroll-behavior: smooth) {
  html {
    scroll-behavior: auto;
  }
}

/* 11. REMOVE ALL UNNECESSARY TRANSITIONS DURING SCROLL STATE CHANGES */
.show-btn,
.menu,
.search,
.theme {
  transition: none;
}

/* 12. FORCE HARDWARE ACCELERATION ON KEY ELEMENTS */
header,
main,
#sidebar,
#footer {
  transform: translateZ(0);
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
}

/* 13. META THEME-COLOR - atomic updates */
@supports (color: var(--theme)) {
  :root {
    --transition-none: all 0s linear;
  }
}
